---
layout: default
title: Documentation
---

<h1>Documentation</h1>

<p>Please see the <a href="/download">download</a> page for installation instructions. The rest of the documentation
is here.</p>

<h2><a name="rest_api"></a>REST API</h2>

<p>The QDB API follows RESTful principles and you don't need any driver libraries to communicate with it. HTTP POST
does create or update, PUT does update only, DELETE deletes stuff and GET retrieves resources. All endpoints accept
JSON data or URL-encoded form data and most return JSON. The examples in this documentation use
<a href="http://curl.haxx.se/">curl</a>.</p>

<p>The usual <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP status codes</a> are used.
POST requests that actually create something return 201 (created), those that just do an update return 200 (ok).
POST and PUT requests both only update fields supplied in the request and leave others as is. A full JSON
representation of the object is returned. Well-formed requests with validation errors return 422 (unprocessable
entity). If a version number is supplied with a request and the version of the object currently on the server is
different then a 409 (conflict) is returned.</p>

<h3><a name="queues"></a>Queues</h3>

<p>QDB queues are ring buffers with a configurable maximum size. When a queue is full the oldest messages are
efficiently deleted in chunks. QDB supports fast retrieval of messages by ID and timestamp. Queues can have
outputs which automatically send messages somewhere else (e.g. to RabbitMQ).</p>

<h3><a name="outputs"></a>Outputs</h3>


<h3><a name="databases"></a>Databases</h3>

<p>Queues in QDB are grouped into databases. There is a database called "default" that is assumed when
no database is specified, which is why these two calls return information about the same queue (foo):</p>

{% highlight bash %}
$ curl http://127.0.0.1:9554/q/foo
$ curl http://127.0.0.1:9554/db/default/q/foo
{% endhighlight %}

<h3><a name="security"></a>Security & Users</h3>

<p>QDB uses HTTP basic authentication. The QDB server creates a user called "admin" on startup with full access
to everything. The default password for the "admin" user is "admin" unless it is changed in the
<a href="#configuration">configuration file</a> or after startup using the API. If no authentication information
is supplied then admin:admin is assumed. Non-admin users can only access databases they own.</p>

{% highlight bash %}
# create an admin user "david" with password "secret"
$ curl -XPOST http://127.0.0.1:9554/users/david -d admin=true -d password=secret
# list all users
$ curl http://127.0.0.1:9554/users
# get details of the "david" user
$ curl http://127.0.0.1:9554/users/david
# authenticate as "david" and list all database visible to "david"
$ curl --user david:secret http://127.0.0.1:9554/db
# change the password for the "admin" user
$ curl -XPOST http://127.0.0.1:9554/users/admin -d password=oink
{% endhighlight %}

<h2><a name="configuration"></a>Configuration</h2>

<p>QDB configuration is optional. The defaults launch a server listening on 127.0.0.1:9554 with no security. This
is appropriate for many applications. On startup QDB looks for a qdb.conf or qdb.properties file in /etc and the
current directory with settings the latter having priority. Example /etc/qdb.properties:</p>

{% highlight properties %}
host = 127.0.0.1
port = 9554
dataDir = data
initialAdminPassword = admin
{% endhighlight %}

<p>For an up-to-date listing of configuration properties and default values please look at
<a href="https://github.com/qdb-io/qdb-server/blob/master/src/main/resources/qdb-default.conf">qdb-default.conf</a>
in the source code.</p>

<h3><a name="java_options"></a>Java Options</h3>

<p>The startup scripts define QDB_SERVER_OPTS="-server" and source /etc/default/qdb for overrides. These options
are passed to the "java" command that runs QDB. You might want to configure memory usage. Example /etc/default.qdb:</p>

{% highlight bash %}
# Start with 64m heap
QDB_SERVER_OPTS="-server -Xmx64m -Xms64m -XX:+UseCompressedOops"
{% endhighlight %}

<h3><a name="logging"></a>Logging</h3>

<p>QDB logs messages to the console by default, which the startup scripts redirect to /var/log/qdb/qdb.log
(Linux) or to ./qdb.log (Generic). GELF logging to a <a href="http://graylog2.org/">Graylog2</a> server is also
supported. Sample /etc/qdb.properties:</p>

{% highlight properties %}
# Port is optional, default is 12201 (Graylog2 default)
graylog2=graylog2.acme.com:12345
# Default is 0.9.6
graylog2ServerVersion=0.9.6
# Only INFO, WARN and ERROR messages are sent to Graylog2, DEBUG only to console
logLevel=DEBUG
# Default logLevel is INFO
{% endhighlight %}
